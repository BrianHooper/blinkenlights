@using Blinkenlights.Models.ViewModels.Utility;
@model UtilityViewModel

<link rel="stylesheet" href="~/css/utility.css" />

<div id="utility-root" title="@Model.Status">
    <div class="util-body">
        @if (Model.MehData != null)
        {

            @if (!string.IsNullOrWhiteSpace(Model.MehData.Title))
            {
                <div class="util-block">
                    <div class="util-row meh-row">                            
                        <div class="util-col">
                                <partial name="ApiStatus" model="@Model.MehData.Status" />
                            </div>
                        <div class="util-col meh-title">@Model.MehData.Title</div>
                    </div>
                    <a class="util-url" href="@Model.MehData.Url" target="_blank"></a>
                </div>
            }
        }

        @if (Model.PackageTrackingData != null)
        {
            @if (Model.PackageTrackingData.Packages?.Any() == true)
            {
                foreach (var package in Model.PackageTrackingData.Packages)
                {
                    <div class="util-block">
                        <div class="util-row pkg-row">
                            <div class="util-col">
                                <partial name="ApiStatus" model="@package.ApiStatus" />
                            </div>
                            <div class="util-col pkgtrack-icon">
                                @if (!string.IsNullOrWhiteSpace(package.Icon))
                                {
                                    <img src="@package.Icon" class="pkg-icon" />
                                }
                            </div>
                            <div class="util-col pkgtrack-name">@package.Package.Name</div>
                            <div class="util-col pkgtrack-status">@package.Status</div>
                            <div class="util-col pkgtrack-eta">@package.Eta</div>
                            <div class="util-col pkgtrack-location">@package.Location</div>
                        </div>
                        <a class="util-url" href="@package.Package.Url" target="_blank"> </a>
                    </div>
                }
            }

            @if (Model.Life360Data?.Distance != null)
            {
                <div class="util-block">
                    <div class="util-row">
                        <div class="util-col">
                            <partial name="ApiStatus" model="@Model.Life360Data.Status" />
                        </div>
                        <div class="util-col">
                            @Model.Life360Data.Distance
                        </div>
                        <div id="util-l360-tdelta" class="util-col" data-time-delta="@Model.Life360Data.TimeDelta">
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

<script type="module">
    import { RefreshLife360Utility } from "./ts-dist/UtilityModule.js";

    RefreshLife360Utility();
    setInterval(RefreshLife360Utility, 3600);
</script>